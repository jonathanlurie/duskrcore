<html>
<head>
  <title>Test</title>
</head>
<body>
  <!-- importing the automatically build module -->
  <script src="../dist/duskrcore.js"></script>

  <!-- The minified version is also accessible -->
  <!-- <script src="../dist/es6module.umd.min.js"></script> -->

  <p>Open Javascript console.</p>
  <input type="file" id="files" multiple />

  <script>

  console.log(duskrcore)

  let xmp = new duskrcore.Xmp()

  // a promise based version of reading file as text
  function readFile(file){
    return new Promise((resolve, reject) => {
      var fr = new FileReader()
      fr.onload = () => {
        resolve(fr.result )
      }
      fr.readAsText(file)
    })
  }

  async function handleFileSelect(evt){
    var files = Array.from(evt.target.files)
    console.log(files)

    // remove files that are larger than 1MB (probably not xmp)
    // kep only xml extensions
    // sort to keep alphabetic order
    files = files.filter(f => f.size < 1024*1024)
                 .filter(f => f.name.endsWith('xmp') || f.name.endsWith('XMP'))
                 .sort((a, b) => a.name < b.name ? -1 : 1)

    let xmpRawDataPromises = files.map(async f => {
      try {
        let fileName = f.name
        let xmpStr = await readFile(f)
        return {
          name: fileName,
          xmpString: xmpStr
        }
      }catch(e){
        console.warn(`The file ${f.name} is not text based.`)
      }
      return null
    })

    let xmpRawData = await Promise.all(xmpRawDataPromises)

    // do something with that
    console.log(xmpRawData)
  }

  document.getElementById('files').addEventListener('change', handleFileSelect, false)

  </script>

</body>
</html>
